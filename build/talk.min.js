!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Talk=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},d=a("wildemitter"),e=a("./pointer"),f=a("./util"),g=a("./peer"),h=function(a){function b(b){a.call(this),this.config={configuration:{iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{url:"stun:stun4.l.google.com:19302"}]},options:{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!0}]},constraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},logger:{warn:f.noop,log:f.noop},stream:new e},this.warn=f.noop,this.log=f.noop,this.peers=[],f.overwrite(this.config,b),this.config.logger&&this.config.logger.log&&this.config.logger.warn&&(this.warn=this.config.logger.warn.bind(this.config.logger),this.log=this.config.logger.log.bind(this.config.logger))}return c(b,a),b.prototype.add=function(a){var b=this,c=new(a||g)(this.config);return c.on("message",function(a,d){b.peers.forEach(function(b){c!==b&&c.get(a,JSON.stringify(d))})}),c.on("*",function(a){for(var d=[],e=0;e<arguments.length-1;e++)d[e]=arguments[e+1];b.emit.apply(b,[a,c.id].concat(d))}),this.log("Peer added:",c),this.peers.push(c),c},b.prototype.get=function(a){var b=this.peers.filter(function(b){for(var c in a)if(a[c]!==b[c])return!1;return!0});switch(b.length){case 0:return!1;case 1:return b[0];default:return b}},b}(d);b.exports=h},{"./peer":2,"./pointer":3,"./util":6,wildemitter:7}],2:[function(a,b){var c=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},d=a("wildemitter"),e=a("./pointer"),f=a("./shims"),g=a("./util"),h=function(a){function b(b){a.call(this),this.config={configuration:{iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{url:"stun:stun4.l.google.com:19302"}]},options:{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!0}]},constraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},logger:{warn:g.noop,log:g.noop},stream:new e},this.id=g.randNum(),this.warn=g.noop,this.log=g.noop,this.channels=[],g.overwrite(this.config,b),this.config.logger&&this.config.logger.log&&this.config.logger.warn&&(this.warn=this.config.logger.warn.bind(this.config.logger),this.log=this.config.logger.log.bind(this.config.logger)),this.pc=new f.PeerConnection(this.config.configuration,this.config.options),this.pc.onnegotiationneeded=this.onNegotiationNeeded.bind(this),this.pc.oniceconnectionstatechange=this.onIceChange.bind(this),this.pc.ondatachannel=this.onDataChannel.bind(this),this.pc.onicecandidate=this.onCandidate.bind(this),this.pc.onicechange=this.onIceChange.bind(this);var c=this.config.stream.get();c&&(this.log("Adding local stream to peer"),this.pc.addStream(c))}return c(b,a),b.prototype.send=function(a,b){this.log("Sending:",a,b),this.emit("message",a,b)},b.prototype.get=function(a,b){switch(b=JSON.parse(b),this.log("Getting:",a,b),a){case"offer":this.answer(b);break;case"answer":this.handleAnswer(b);break;case"candidate":this.handleCandidate(b)}},b.prototype.onDataChannel=function(a){a.channel&&this.channels.push(a.channel)},b.prototype.onIceChange=function(){switch(this.pc.iceConnectionState){case"disconnected":case"failed":this.warn("The iceConnectionState is disconnected, closing the peer:",this),this.pc.close();break;case"completed":this.pc.onicecandidate=g.noop}},b.prototype.onCandidate=function(a){a.candidate&&(this.log("Found candidate:",a.candidate),this.send("candidate",a.candidate),this.pc.onicecandidate=g.noop)},b.prototype.handleCandidate=function(a){a.sdpMLineIndex&&a.candidate&&(this.log("Handling received candidate:",a),this.pc.addIceCandidate(new f.IceCandidate(a)))},b.prototype.onNegotiationNeeded=function(){this.log("'negotiationneeded' triggered!"),"stable"===this.pc.signalingState?this.offer():this.warn("Signaling state is not stable!")},b.prototype.offer=function(){var a=this;this.log("Making an offer"),this.pc.createOffer(function(b){a.pc.setLocalDescription(b,function(){a.send("offer",b)},function(b){a.warn(b)})},function(b){a.warn(b)},this.config.constraints)},b.prototype.answer=function(a){var b=this;this.log("Answering an offer"),this.pc.setRemoteDescription(new f.SessionDescription(a),function(){b.pc.createAnswer(function(a){b.pc.setLocalDescription(a,function(){b.send("answer",a)},function(a){b.warn(a)})},function(a){b.warn(a)},b.config.constraints)},function(a){b.warn(a)})},b.prototype.handleAnswer=function(a){var b=this;this.pc.setRemoteDescription(new f.SessionDescription(a),function(){b.log("Answer handled successfully")},function(a){b.warn(a)})},b}(d);b.exports=h},{"./pointer":3,"./shims":4,"./util":6,wildemitter:7}],3:[function(a,b){var c=a("./util"),d=function(){function a(a){this.storage={value:null},c.isNone(a)||(this.storage.value=a)}return a.prototype.set=function(a){return this.storage.value=a,a},a.prototype.get=function(){return this.storage.value},a}();b.exports=d},{"./util":6}],4:[function(a,b){var c=function(){function a(){}return a.getUserMedia=function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia).apply(navigator,a)},a.SessionDescription=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription,a.PeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,a.IceCandidate=window.RTCIceCandidate||window.webkitRTCIceCandidate||window.mozRTCIceCandidate,a}();b.exports=c},{}],5:[function(a,b){var c=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},d=a("wildemitter"),e=a("./handler"),f=a("./pointer"),g=a("./shims"),h=a("./peer"),i=a("./util"),j=function(a){function b(b){a.call(this),this.localStream=new f,this.config={configuration:{iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{url:"stun:stun4.l.google.com:19302"}]},options:{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!0}]},constraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},logger:{warn:i.noop,log:i.noop},server:"http://localhost:8000",stream:this.localStream},this.warn=i.noop,this.log=i.noop,this.handlers={},i.overwrite(this.config,b),this.config.logger&&this.config.logger.log&&this.config.logger.warn&&(this.warn=this.config.logger.warn.bind(this.config.logger),this.log=this.config.logger.log.bind(this.config.logger)),this.on("*",function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];this.log.apply(this,["Event: "].concat(a))})}return c(b,a),b.prototype.create=function(a,b){var c=this;if(!this.handlers[a]){var d=new(b||e)(this.config);return d.on("*",function(b,d){for(var e=[],f=0;f<arguments.length-2;f++)e[f]=arguments[f+2];c.emit.apply(c,[b,a,d].concat(e))}),this.handlers[a]=d,d}throw Error("Handler already exists!")},b.prototype.get=function(a){return this.handlers[a]?this.handlers[a]:this.create(a)},b.prototype.getUserMedia=function(a,b){var c=this;return g.getUserMedia({audio:this.config.constraints.mandatory.OfferToReceiveAudio=a,video:this.config.constraints.mandatory.OfferToReceiveVideo=b},function(a){c.localStream.set(a),c.emit("localStream",a)},function(a){throw c.warn(a),Error(a)}),this.localStream.get()},b.Pointer=f,b.Handler=e,b.Util=i,b.Peer=h,b}(d);b.exports=j},{"./handler":1,"./peer":2,"./pointer":3,"./shims":4,"./util":6,wildemitter:7}],6:[function(a,b){var c=function(){function a(){}return a.safeCb=function(a){return"function"==typeof a?a:this.noop},a.safeStr=function(a){return this.isString(a)?a.replace(/\s/g,"-").replace(/[^A-Za-z0-9_\-]/g,"").toString():""},a.safeText=function(a){return this.isString(a)?a.replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""},a.isNone=function(a){return void 0===a||null===a},a.isEmpty=function(a){if(null===a||void 0===a)return!0;if(Array.isArray(a)||"string"==typeof a)return 0===a.length;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},a.isString=function(a){return"string"==typeof a&&!this.isEmpty(a)},a.isObject=function(a){return a===Object(a)},a.randNum=function(a,b){return b=b||Math.pow(10,16),a=a||0,Math.floor(Math.random()*(b-a+1)+a)},a.randWord=function(a){a=a||8;for(var b="";a>0;a--)b+=Math.floor(a/2)===a/2?"bcdfghjklmnpqrstvwxyz"[this.randNum(0,20)]:"aeiou"[this.randNum(0,4)];return b},a.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},a.isBool=function(a){return"boolean"==typeof a},a.sha256=function(a){return this.isEmpty(a)?"":CryptoJS.SHA256(a).toString()},a.find=function(a,b){return a.indexOf(b)>=0},a.extend=function(a,b){if(a=a||{},!this.isEmpty(b))for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.overwrite=function(a,b){if(!this.isEmpty(a)&&!this.isEmpty(b))for(var c in a)a.hasOwnProperty(c)&&b.hasOwnProperty(c)&&(a[c]=b[c]);return a||{}},a.noop=function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0]},a}();b.exports=c},{}],7:[function(a,b){function c(){this.callbacks={}}b.exports=c,c.prototype.on=function(a){var b=3===arguments.length,c=b?arguments[1]:void 0,d=b?arguments[2]:arguments[1];return d._groupName=c,(this.callbacks[a]=this.callbacks[a]||[]).push(d),this},c.prototype.once=function(a){function b(){c.off(a,b),f.apply(this,arguments)}var c=this,d=3===arguments.length,e=d?arguments[1]:void 0,f=d?arguments[2]:arguments[1];return this.on(a,e,b),this},c.prototype.releaseGroup=function(a){var b,c,d,e;for(b in this.callbacks)for(e=this.callbacks[b],c=0,d=e.length;d>c;c++)e[c]._groupName===a&&(e.splice(c,1),c--,d--);return this},c.prototype.off=function(a,b){var c,d=this.callbacks[a];return d?1===arguments.length?(delete this.callbacks[a],this):(c=d.indexOf(b),d.splice(c,1),this):this},c.prototype.emit=function(a){var b,c,d,e=[].slice.call(arguments,1),f=this.callbacks[a],g=this.getWildcardCallbacks(a);if(f)for(d=f.slice(),b=0,c=d.length;c>b&&d[b];++b)d[b].apply(this,e);if(g)for(c=g.length,d=g.slice(),b=0,c=d.length;c>b&&d[b];++b)d[b].apply(this,[a].concat(e));return this},c.prototype.getWildcardCallbacks=function(a){var b,c,d=[];for(b in this.callbacks)c=b.split("*"),("*"===b||2===c.length&&a.slice(0,c[0].length)===c[0])&&(d=d.concat(this.callbacks[b]));return d}},{}]},{},[5])(5)});var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=d.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;return b&&c.mixIn(b),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),f=d.WordArray=e.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,e=a.sigBytes;if(this.clamp(),d%4)for(var f=0;e>f;f++){var g=c[f>>>2]>>>24-f%4*8&255;b[d+f>>>2]|=g<<24-(d+f)%4*8}else if(c.length>65535)for(var f=0;e>f;f+=4)b[d+f>>>2]=c[f>>>2];else b.push.apply(b,c);return this.sigBytes+=e,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=e.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new f.init(c,b)}}),g=c.enc={},h=g.Hex={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push((f>>>4).toString(16)),d.push((15&f).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new f.init(c,b/2)}},i=g.Latin1={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push(String.fromCharCode(f))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new f.init(c,b)}},j=g.Utf8={stringify:function(a){try{return decodeURIComponent(escape(i.stringify(a)))}catch(b){throw new Error("Malformed UTF-8 data")}},parse:function(a){return i.parse(unescape(encodeURIComponent(a)))}},k=d.BufferedBlockAlgorithm=e.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=j.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,g=this.blockSize,h=4*g,i=e/h;i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0);var j=i*g,k=a.min(4*j,e);if(j){for(var l=0;j>l;l+=g)this._doProcessBlock(d,l);var m=d.splice(0,j);c.sigBytes-=k}return new f.init(m,k)},clone:function(){var a=e.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0}),l=(d.Hasher=k.extend({cfg:e.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new l.HMAC.init(a,c).finalize(b)}}}),c.algo={});return c}(Math);!function(a){var b=CryptoJS,c=b.lib,d=c.WordArray,e=c.Hasher,f=b.algo,g=[],h=[];!function(){function b(b){for(var c=a.sqrt(b),d=2;c>=d;d++)if(!(b%d))return!1;return!0}function c(a){return 4294967296*(a-(0|a))|0}for(var d=2,e=0;64>e;)b(d)&&(8>e&&(g[e]=c(a.pow(d,.5))),h[e]=c(a.pow(d,1/3)),e++),d++}();var i=[],j=f.SHA256=e.extend({_doReset:function(){this._hash=new d.init(g.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],g=c[3],j=c[4],k=c[5],l=c[6],m=c[7],n=0;64>n;n++){if(16>n)i[n]=0|a[b+n];else{var o=i[n-15],p=(o<<25|o>>>7)^(o<<14|o>>>18)^o>>>3,q=i[n-2],r=(q<<15|q>>>17)^(q<<13|q>>>19)^q>>>10;i[n]=p+i[n-7]+r+i[n-16]}var s=j&k^~j&l,t=d&e^d&f^e&f,u=(d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22),v=(j<<26|j>>>6)^(j<<21|j>>>11)^(j<<7|j>>>25),w=m+v+s+h[n]+i[n],x=u+t;m=l,l=k,k=j,j=g+w|0,g=f,f=e,e=d,d=w+x|0}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+g|0,c[4]=c[4]+j|0,c[5]=c[5]+k|0,c[6]=c[6]+l|0,c[7]=c[7]+m|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;return c[e>>>5]|=128<<24-e%32,c[(e+64>>>9<<4)+14]=a.floor(d/4294967296),c[(e+64>>>9<<4)+15]=d,b.sigBytes=4*c.length,this._process(),this._hash},clone:function(){var a=e.clone.call(this);return a._hash=this._hash.clone(),a}});b.SHA256=e._createHelper(j),b.HmacSHA256=e._createHmacHelper(j)}(Math);